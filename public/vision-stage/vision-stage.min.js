import e from"./z-console.js";export{default as log}from"./z-console.js";const t=new WeakMap,s=e=>(...s)=>{const i=e(...s);return t.set(i,!0),i},i=e=>"function"==typeof e&&t.has(e),n="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,r=(e,t,s=null,i=null)=>{for(;t!==s;){const s=t.nextSibling;e.insertBefore(t,i),t=s}},o=(e,t,s=null)=>{for(;t!==s;){const s=t.nextSibling;e.removeChild(t),t=s}},a={},l={},h=`{{lit-${String(Math.random()).slice(2)}}}`,c=`\x3c!--${h}--\x3e`,d=new RegExp(`${h}|${c}`),u="$lit$";class p{constructor(e,t){this.parts=[],this.element=t;const s=[],i=[],n=document.createTreeWalker(t.content,133,null,!1);let r=0,o=-1,a=0;const{strings:l,values:{length:c}}=e;for(;a<c;){const e=n.nextNode();if(null!==e){if(o++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:s}=t;let i=0;for(let e=0;e<s;e++)g(t[e].name,u)&&i++;for(;i-- >0;){const t=l[a],s=_.exec(t)[2],i=s.toLowerCase()+u,n=e.getAttribute(i);e.removeAttribute(i);const r=n.split(d);this.parts.push({type:"attribute",index:o,name:s,strings:r}),a+=r.length-1}}"TEMPLATE"===e.tagName&&(i.push(e),n.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(h)>=0){const i=e.parentNode,n=t.split(d),r=n.length-1;for(let t=0;t<r;t++){let s,r=n[t];if(""===r)s=f();else{const e=_.exec(r);null!==e&&g(e[2],u)&&(r=r.slice(0,e.index)+e[1]+e[2].slice(0,-u.length)+e[3]),s=document.createTextNode(r)}i.insertBefore(s,e),this.parts.push({type:"node",index:++o})}""===n[r]?(i.insertBefore(f(),e),s.push(e)):e.data=n[r],a+=r}}else if(8===e.nodeType)if(e.data===h){const t=e.parentNode;null!==e.previousSibling&&o!==r||(o++,t.insertBefore(f(),e)),r=o,this.parts.push({type:"node",index:o}),null===e.nextSibling?e.data="":(s.push(e),o--),a++}else{let t=-1;for(;-1!==(t=e.data.indexOf(h,t+1));)this.parts.push({type:"node",index:-1}),a++}}else n.currentNode=i.pop()}for(const e of s)e.parentNode.removeChild(e)}}const g=(e,t)=>{const s=e.length-t.length;return s>=0&&e.slice(s)===t},m=e=>-1!==e.index,f=()=>document.createComment(""),_=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class v{constructor(e,t,s){this.__parts=[],this.template=e,this.processor=t,this.options=s}update(e){let t=0;for(const s of this.__parts)void 0!==s&&s.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=n?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],s=this.template.parts,i=document.createTreeWalker(e,133,null,!1);let r,o=0,a=0,l=i.nextNode();for(;o<s.length;)if(r=s[o],m(r)){for(;a<r.index;)a++,"TEMPLATE"===l.nodeName&&(t.push(l),i.currentNode=l.content),null===(l=i.nextNode())&&(i.currentNode=t.pop(),l=i.nextNode());if("node"===r.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(l.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(l,r.name,r.strings,this.options));o++}else this.__parts.push(void 0),o++;return n&&(document.adoptNode(e),customElements.upgrade(e)),e}}const b=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),w=` ${h} `;class y{constructor(e,t,s,i){this.strings=e,this.values=t,this.type=s,this.processor=i}getHTML(){const e=this.strings.length-1;let t="",s=!1;for(let i=0;i<e;i++){const e=this.strings[i],n=e.lastIndexOf("\x3c!--");s=(n>-1||s)&&-1===e.indexOf("--\x3e",n+1);const r=_.exec(e);t+=null===r?e+(s?w:c):e.substr(0,r.index)+r[1]+r[2]+u+r[3]+h}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==b&&(t=b.createHTML(t)),e.innerHTML=t,e}}class x extends y{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const e=super.getTemplateElement(),t=e.content,s=t.firstChild;return t.removeChild(s),r(t,s.firstChild),e}}const N=e=>null===e||!("object"==typeof e||"function"==typeof e),A=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class S{constructor(e,t,s){this.dirty=!0,this.element=e,this.name=t,this.strings=s,this.parts=[];for(let e=0;e<s.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new E(this)}_getValue(){const e=this.strings,t=e.length-1,s=this.parts;if(1===t&&""===e[0]&&""===e[1]){const e=s[0].value;if("symbol"==typeof e)return String(e);if("string"==typeof e||!A(e))return e}let i="";for(let n=0;n<t;n++){i+=e[n];const t=s[n];if(void 0!==t){const e=t.value;if(N(e)||!A(e))i+="string"==typeof e?e:String(e);else for(const t of e)i+="string"==typeof t?t:String(t)}}return i+=e[t],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class E{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===a||N(e)&&e===this.value||(this.value=e,i(e)||(this.committer.dirty=!0))}commit(){for(;i(this.value);){const e=this.value;this.value=a,e(this)}this.value!==a&&this.committer.commit()}}class k{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(f()),this.endNode=e.appendChild(f())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=f()),e.__insert(this.endNode=f())}insertAfterPart(e){e.__insert(this.startNode=f()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;i(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=a,e(this)}const e=this.__pendingValue;e!==a&&(N(e)?e!==this.value&&this.__commitText(e):e instanceof y?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):A(e)?this.__commitIterable(e):e===l?(this.value=l,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,s="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=s:this.__commitNode(document.createTextNode(s)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof v&&this.value.template===t)this.value.update(e.values);else{const s=new v(t,e.processor,this.options),i=s._clone();s.update(e.values),this.__commitNode(i),this.value=s}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let s,i=0;for(const n of e)s=t[i],void 0===s&&(s=new k(this.options),t.push(s),0===i?s.appendIntoPart(this):s.insertAfterPart(t[i-1])),s.setValue(n),s.commit(),i++;i<t.length&&(t.length=i,this.clear(s&&s.endNode))}clear(e=this.startNode){o(this.startNode.parentNode,e.nextSibling,this.endNode)}}class T{constructor(e,t,s){if(this.value=void 0,this.__pendingValue=void 0,2!==s.length||""!==s[0]||""!==s[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=s}setValue(e){this.__pendingValue=e}commit(){for(;i(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=a,e(this)}if(this.__pendingValue===a)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=a}}class F extends S{constructor(e,t,s){super(e,t,s),this.single=2===s.length&&""===s[0]&&""===s[1]}_createPart(){return new L(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class L extends E{}let R=!1;(()=>{try{const e={get capture(){return R=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class P{constructor(e,t,s){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=s,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;i(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=a,e(this)}if(this.__pendingValue===a)return;const e=this.__pendingValue,t=this.value,s=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),n=null!=e&&(null==t||s);s&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),n&&(this.__options=C(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=a}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const C=e=>e&&(R?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);const V=new class{handleAttributeExpressions(e,t,s,i){const n=t[0];if("."===n){return new F(e,t.slice(1),s).parts}if("@"===n)return[new P(e,t.slice(1),i.eventContext)];if("?"===n)return[new T(e,t.slice(1),s)];return new S(e,t,s).parts}handleTextExpression(e){return new k(e)}};function M(e){let t=O.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},O.set(e.type,t));let s=t.stringsArray.get(e.strings);if(void 0!==s)return s;const i=e.strings.join(h);return s=t.keyString.get(i),void 0===s&&(s=new p(e,e.getTemplateElement()),t.keyString.set(i,s)),t.stringsArray.set(e.strings,s),s}const O=new Map,$=new WeakMap;"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const j=(e,...t)=>new y(e,t,"html",V),z=(e,...t)=>new x(e,t,"svg",V),I=new WeakMap,W=s((e=>t=>{if(!(t instanceof k))throw new Error("unsafeHTML can only be used in text bindings");const s=I.get(t);if(void 0!==s&&N(e)&&e===s.value&&t.value===s.fragment)return;const i=document.createElement("template");i.innerHTML=e;const n=document.importNode(i.content,!0);t.setValue(n),I.set(t,{value:e,fragment:n})})),H=new WeakMap,q=s((e=>t=>{const s=H.get(t);if(void 0===e&&t instanceof E){if(void 0!==s||!H.has(t)){const e=t.committer.name;t.committer.element.removeAttribute(e)}}else e!==s&&t.setValue(e);H.set(t,e)})),B=(e,t)=>{const s=e.startNode.parentNode,i=void 0===t?e.endNode:t.startNode,n=s.insertBefore(f(),i);s.insertBefore(f(),i);const r=new k(e.options);return r.insertAfterNode(n),r},D=(e,t)=>(e.setValue(t),e.commit(),e),U=(e,t,s)=>{const i=e.startNode.parentNode,n=s?s.startNode:e.endNode,o=t.endNode.nextSibling;o!==n&&r(i,t.startNode,o,n)},G=e=>{o(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},J=(e,t,s)=>{const i=new Map;for(let n=t;n<=s;n++)i.set(e[n],n);return i},K=new WeakMap,Q=new WeakMap,X=s(((e,t,s)=>{let i;return void 0===s?s=t:void 0!==t&&(i=t),t=>{if(!(t instanceof k))throw new Error("repeat can only be used in text bindings");const n=K.get(t)||[],r=Q.get(t)||[],o=[],a=[],l=[];let h,c,d=0;for(const t of e)l[d]=i?i(t,d):d,a[d]=s(t,d),d++;let u=0,p=n.length-1,g=0,m=a.length-1;for(;u<=p&&g<=m;)if(null===n[u])u++;else if(null===n[p])p--;else if(r[u]===l[g])o[g]=D(n[u],a[g]),u++,g++;else if(r[p]===l[m])o[m]=D(n[p],a[m]),p--,m--;else if(r[u]===l[m])o[m]=D(n[u],a[m]),U(t,n[u],o[m+1]),u++,m--;else if(r[p]===l[g])o[g]=D(n[p],a[g]),U(t,n[p],n[u]),p--,g++;else if(void 0===h&&(h=J(l,g,m),c=J(r,u,p)),h.has(r[u]))if(h.has(r[p])){const e=c.get(l[g]),s=void 0!==e?n[e]:null;if(null===s){const e=B(t,n[u]);D(e,a[g]),o[g]=e}else o[g]=D(s,a[g]),U(t,s,n[u]),n[e]=null;g++}else G(n[p]),p--;else G(n[u]),u++;for(;g<=m;){const e=B(t,o[m+1]);D(e,a[g]),o[g++]=e}for(;u<=p;){const e=n[u++];null!==e&&G(e)}K.set(t,o),Q.set(t,l)}})),Y=s((e=>t=>{let s;if(t instanceof P||t instanceof k)throw new Error("The `live` directive is not allowed on text or event bindings");if(t instanceof T)Z(t.strings),s=t.element.hasAttribute(t.name),t.value=s;else{const{element:i,name:n,strings:r}=t.committer;if(Z(r),t instanceof L){if(s=i[n],s===e)return}else t instanceof E&&(s=i.getAttribute(n));if(s===String(e))return}t.setValue(e)})),Z=e=>{if(2!==e.length||""!==e[0]||""!==e[1])throw new Error("`live` bindings can only contain a single expression")},ee=new WeakMap,te=s(((e,t)=>s=>{const i=ee.get(s);if(Array.isArray(e)){if(Array.isArray(i)&&i.length===e.length&&e.every(((e,t)=>e===i[t])))return}else if(i===e&&(void 0!==e||ee.has(s)))return;s.setValue(t()),ee.set(s,Array.isArray(e)?Array.from(e):e)})),se=new WeakMap,ie=s((e=>t=>{if(!(t instanceof k))throw new Error("cache can only be used in text bindings");let s=se.get(t);void 0===s&&(s=new WeakMap,se.set(t,s));const i=t.value;if(i instanceof v){if(e instanceof y&&i.template===t.options.templateFactory(e))return void t.setValue(e);{let e=s.get(i.template);void 0===e&&(e={instance:i,nodes:document.createDocumentFragment()},s.set(i.template,e)),r(e.nodes,t.startNode.nextSibling,t.endNode)}}if(e instanceof y){const i=t.options.templateFactory(e),n=s.get(i);void 0!==n&&(t.setValue(n.nodes),t.commit(),t.value=n.instance)}t.setValue(e)})),ne="MacIntel"===navigator.platform,re=/iPad|iPhone|iPod/.test(navigator.platform)||ne&&navigator.maxTouchPoints>1,oe=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ae=(e,t)=>t?e:"",le=e=>Object.getPrototypeOf(e).constructor;function he(e,t=3){return"string"==typeof e&&(e=parseFloat(e)),e.toFixed(t+1).slice(0,-1)}const ce=e=>!!e&&"object"==typeof e&&!Array.isArray(e);function de(e,t=1e3,s=0,i=!1,n=100){let r,o,a,l,h,c=0,d=!1,u=!1;return function(...e){r=e,h=Date.now(),c=h,d||(d=!0,l=h,a=setInterval(p,n))};function p(){h=Date.now(),o=h-c,i&&!u?(u=!0,l=h,e(...r)):o>t?(d=!1,u=!1,l=h,clearInterval(a),e(...r)):s&&h-l>s&&(l=h,e(...r))}}const ue="/_components/";e("info","•• Vision Stage ••","2023.01.09","(w/ lit-html 1.4.1)");const pe={};let ge,me,fe,_e,ve;const be=new Set,we={delete:"trash",remove:"cross",add:"plus","+":"plus",x:"cross"},ye={"double-chevron-right":"0 0 1024 1024","arrow-right-rounded":"0 0 45.6 45.6",fanion:"0 -11 100 120"},xe=new Set;class Ne extends HTMLElement{constructor(){if(super(),"vision-stage"===this.localName){ge=this,this.id="app",this.languages=le(this).languages;const t=decodeURI(location.pathname);this.app_name=this.ns=t.replace(/\//g,"")||"home",function(t){if(fe=t,!t)return void e("err","no store namespace");let s=localStorage.getItem(t);if(e("ok","RAW:",s),s)try{me=JSON.parse(s)}catch(t){e("err","JSON parse error"),e("warn","stored_data:",s)}me&&ce(me)?pe.store&&(e("ok","GOT store:"),e(me)):(pe.store&&e("notok","NO STORE, CREATING ONE"),me={})}(this.ns),this.buildCSSForLangs()}this.#e(),"vision-stage"!==this.localName&&this.uses([["vision-stage","lang"]])}connectedCallback(){this.onConnected&&this.onConnected()}#e(){const t=le(this);let s;this.is_component=!0,this._state={},s=t.properties&&t._properties?Object.assign({},t._properties,t.properties):t.properties||t._properties;let i=s?Object.entries(s):[];for(let[t,n]of i){ce(n)?n.storable&&!this.id&&e("warn","trying to store:",t,"...but no id on element (for store); "):n={value:n};let i=this.id,r=i?je(i,t):void 0,o=void 0!==r?r:n.value;if(void 0!==r?n.storable?this._state[t]=r:ze(i,t,null,!0):n.storable&&ze(i,t,n.value),n.class&&this.classList.toggle(n.class,!!o),n.attribute&&requestAnimationFrame((e=>{if("string"==typeof n.attribute)this.setAttribute(n.attribute,o);else{let e=n.attribute[0];if("bool"===n.attribute[1])o?this.setAttribute(e,""):this.removeAttribute(e);else{if("auto"!==n.attribute[1])throw"Unknown attribute type";o?this.setAttribute(e,o):this.removeAttribute(e)}}})),Object.defineProperty(this,t,{get(){return n.getter?n.getter.call(this,this._state[t]):this._state[t]},set(i){let a=this.id;if(n.storable&&!a&&e("err","no store id for prop:",t,this),t in s){let s,l=!1,h=this._state[t];n.transformer&&!this.bypass_transformer&&(s=n.transformer.call(this,i,h,n.value,r));let c=n.force_render;if((i===h&&!c||"cancel"===s)&&(l=!0),void 0!==s&&(i=s),n.storable&&(me[a]||={},me[a][t]=i,We()),this._state[t]=i,this.block_watcher||n.watcher&&n.watcher.call(this,i,h),n.attribute)if("string"==typeof n.attribute)this.setAttribute(n.attribute,i);else{let e=n.attribute[0];if("bool"===n.attribute[1])o?this.setAttribute(e,""):this.removeAttribute(e);else{if("auto"!==n.attribute[1])throw"Unknown attribute type";i?this.setAttribute(e,i):this.removeAttribute(e)}}n.class&&this.classList.toggle(n.class,!!i),!1===n.reactive||l||this.render(),this.renders&&this.renders.has(t)&&requestAnimationFrame((s=>{for(let s of this.renders.get(t))pe.renders&&e("check","prop, render target:",t,s),s.render()}))}else e("err","NO own prop on this:",t,s)}}),!0===n.init_watcher){let e=this._state[t];this._state[t]=o,n.watcher&&n.watcher.call(this,o,e)}else this._state[t]=o,"onRendered"===n.init_watcher?this.setOnRendered=[t,o]:"deferred"===n.init_watcher&&setTimeout((()=>{this[t]=o}))}const n=t.strings?(r=t.strings,JSON.parse(JSON.stringify(r))):{};var r;if(t._strings&&Object.assign(n,t._strings),t.strings){ge.languages||e("err","no app languages yet",this),this.strings=n;for(let e in n)Object.defineProperty(this,"$"+e,{get(){return this.getString(e)},set(){throw"cannot set a string"}})}if(this.onResized&&!be.has(this)&&be.add(this),t.attributes)for(let e of t.attributes)this[e]=this.getAttribute(e);t.sounds&&(ge.sounds_list=t.sounds)}uses(t){for(let i of t){let t=i[0],n=i.slice(1);if(pe.uses&&n.length&&e("info","<"+(this.id||this.tagName+"::"+this.className)+">","will render when any of [",...n,"] on","<"+t+">","is set"),"string"==typeof t){let e=t;if(s=e,t=document.querySelector(s),!t)throw"uses(); prop_holder do not exist (yet?): "+e}t||(e("err","no prop holder, entry:",i),e("info","<"+(this.id||this.tagName+"::"+this.className)+">","will render when any of [",...n,"] on","<"+t+">","is set")),t.renders=t.renders||new Map;for(let e of n)t.renders.has(e)?t.renders.get(e).add(this):t.renders.set(e,new Set([this]))}var s}setState(e,t){this._state[e]=t}setAttr(e,t){this.setAttribute(e,t),this.render()}async render(t){if(!this.template)return void("vision-stage"!==this.localName&&e("warn","--no template, cannot render(): "+this.id+", "+this.tagName));const s=!0===pe.render||Array.isArray(pe.render)&&pe.render.includes(this.id||this.classList[0]);if(this.needsRender)s&&e("gold","already needsRender, waiting:",this.id||this.classList[0]);else{if(this.needsRender=!0,await new Promise((e=>requestAnimationFrame(e))),!this.rendered&&this.beforeFirstRender&&this.beforeFirstRender(),this.beforeRender&&!1===this.beforeRender())return void e("err","Aborted render for:",this.id);this.needsRender=!1;const i=this.template();if(!i)return void(s&&e("err","--tmpl: no value -> no render",this.id,this.localName));s&&e("gold","--GOT TMPL, RENDER ",this.id||this.classList[0]),((e,t,s)=>{let i=$.get(t);void 0===i&&(o(t,t.firstChild),$.set(t,i=new k(Object.assign({templateFactory:M},s))),i.appendInto(t)),i.setValue(e),i.commit()})(i,this,{scopeName:this.localName,eventContext:t||this.event_context||this});const n=this.rendered;if(this.rendered=!0,n||(this._onFirstRendered&&this._onFirstRendered(),this.onFirstRendered&&this.onFirstRendered(),this.skipped_onResized&&(this.skipped_onResized=!1,this.onResized(...this.skipped_params),this.skipped_params=null)),this._onRendered&&this._onRendered(),this.onRendered&&this.onRendered(),this.setOnRendered){let[e,t]=this.setOnRendered;this[e]=t,this.setOnRendered=null}}}q(e){return this.querySelector(e)}qAll(e){return Array.from(this.querySelectorAll(e))}getString(t,s=!1){if(!t)return"";if(!this.strings[t])return e("warn","NO STRING FOUND FOR:",t),"";let i=(ge||this).lang,n=this.languages.indexOf(i),r=this.strings[t][n]||this.strings[t][0];return s?r:(e=>(e=>/\<\S.*?\S\>/.test(e))(e)||(e=>/&[\d\w]+;/.test(e))(e))(r)?W(r):r.startsWith(">")?W(r.slice(1)):r}switchClasses(e,t,s){this.classList.toggle(e,s),this.classList.toggle(t,!s)}getAttributeList(e,t){return(this.getAttribute(e)||this.getAttribute(t)).split(/\s*[,\s]\s*/)}getStringList(e){return e.split(/\s*[,\s]\s*/)}static async load(t,s){if(pe.load&&e("ok","load() file_path:",t),xe.has(t))return;let i,n;var r;return xe.add(t),Array.isArray(t)?(i=t[0]+".js",n=t[1]+".css"):t.endsWith(".js")?i=t:(i=t+".js",n=t+".css"),/^\./.test(n)?n=location.pathname+n.replace(/^\.\//,""):/^\./.test(n)||(n=`${ke+ue}${n}`),i=/^\./.test(i)?location.pathname+i.replace(/^\.\//,""):`${ke+ue}${i}`,pe.load&&e("purple","load js, css :",i,n),n&&await(r=n,new Promise(((e,t)=>{let s=document.createElement("link");s.onerror=e=>console.error("Error loading stylesheet:",r),s.onload=()=>e(r),s.rel="stylesheet",document.head.appendChild(s),s.href=r}))),import(i)}static loadAll(...e){return e=e.map((e=>Ne.load(e))),Promise.all(e)}}let Ae;class Se extends Ne{constructor(){super(),this.lang=this.lang,this.is_iOS=re,this.scrolls=this.classList.contains("scroll");{const e="onpagehide"in self?"pagehide":"unload";window.addEventListener(e,(e=>ze()))}this.foldable_button_select_components=new Set,document.body.addEventListener("pointerdown",(e=>{if(document.body.classList.add("using-mouse"),!e.target.closest("vs-selector[folds]"))for(let e of this.foldable_button_select_components)e.folded||(e.folded=!0)})),document.body.addEventListener("keydown",(e=>{e.key&&document.body.classList.remove("using-mouse")})),window.addEventListener("hashchange",this.onHashChanged.bind(this)),this.updateAspect(le(this).aspects),this._onInstallable=this.onInstallable.bind(this),this._onInstalled=this.onInstalled.bind(this),window.addEventListener("beforeinstallprompt",this._onInstallable),window.addEventListener("appinstalled",(()=>this._onInstalled))}async onInstallable(t){t.preventDefault(),this.deferredPrompt=t,e("pink","App is installable"),this.classList.add("installable")}install(t){this.deferredPrompt?this.deferredPrompt.prompt():e("err","no deferredPrompt",this)}onInstalled(t){e("ok","App installed"),this.deferredPrompt=null,this.classList.remove("installable")}connectedCallback(){this.onConnected&&this.onConnected(),this.$doc_title&&(document.title=this.$doc_title+" • "+decodeURI(location.hash.slice(1))),le(this).sounds&&this.setupSounds()}onHashChanged(e){this.setPageFromHash()}setPageFromHash(){let t=decodeURI(location.hash.slice(1));if(!t)return""!==this.page&&(this.page=""),void(this.$doc_title&&(document.title=this.$doc_title));let[s,...i]=t.split("/");this.params=i?i.map((e=>e.split("="))).map((([e,t])=>[e,"true"===t||"false"!==t&&(isNaN(t)?t:parseFloat(t))])):[];let n="";e:for(let[e,t]of this.pages)for(let i in t)if(t[i].path===s){n=e;break e}if(!n)return e("err","unknown path:",t),void(this.page="");this.page=n;let{path:r,title:o}=this.getPage();this.$doc_title&&(document.title=this.$doc_title+" • "+o)}getPage(t=null){if(!this.pages)return e("warn","no pages yet"),null;let s=null===t?this.page:t,i=this.pages.find((([e])=>s===e)),n=this.lang;if(i&&!i[1][n])throw"Missing string for page with current lang: "+s+" -> "+n;return i?i[1][n]:{}}pageLink(e,t="",s=""){if(!this.pages)return"";let i=e.startsWith("/")?"/":"./#",n=this.getPage(e);return"/"===i&&(n.path=e.slice(1)),t?j`<a class=${ae("selected",e===this.page)}
				href='${i}${e?n.path:""}'>${n.title}</a><span class='nav-sep'>${t}</span>`:j`<a class=${ae("selected",e===this.page)+" "+s}
				href='${i}${e?n.path:""}'>${n.title}</a>`}_onFirstRendered(){let e=le(this).pages;e&&(this.pages=Object.entries(e).map((([e,t])=>{let s={},i=0;for(let e of t){s[this.languages[i++]]={title:e,path:e.replace(/\s/g,"-")}}return[e,s]}))),this.setPageFromHash()}stringOrLocale(e){return"string"==typeof e?e:e[this.lang]||e[this.languages[0]]}afterResize(e){ge.resizing=!1,ge.updateScrollbarClass()}_onRendered(){let e=this.q("main");e&&(this.main=e),this.updateScrollbarClass()}updateScrollbarClass(){if(this.main&&this.main.classList.contains("scroll")){let e=this.main.scrollHeight>this.main.offsetHeight;this.classList.toggle("main-has-scrollbar",e)}}resize(){if(this.resize_locked)return;this.resizing=!0,clearTimeout(_e),_e=setTimeout(this.afterResize,1e3);const e=ve.threshold,t=document.documentElement,s=this.font_size_decimals||0;let i=window.innerWidth,n=window.innerHeight;const r={now:parseFloat(he(i/n)),min:0},o=ve.portrait&&r.now<e||!ve.landscape;this.is_portrait=o;let a=this.is_portrait?ve.portrait_height||ve.height||40:ve.landscape_height||ve.height||40;this.is_portrait?(r.min=ve.portrait_min,r.base=ve.portrait,r.max=ve.portrait_max,r.tall=r.base):(r.min=r.base=ve.landscape||1.6,r.max=ve.landscape_max||11,r.wide=r.base);let l=0,h=r.now>r.max,c=r.now<r.base;const d=ve.cross_margin;this.is_portrait?d&&r.now>r.max&&(l=d):l=h||c?d:0,this.setAttribute("orientation",this.is_portrait?"portrait":"landscape");let u=r.now,p=u<ve.portrait?"portrait-min":u<ve.portrait_max?"portrait-mid":u<ve.threshold?"portrait-max":u<ve.landscape?"landscape-min":u<ve.landscape_max?"landscape-mid":"landscape-max";if(this.setAttribute("aspect-range",p),"string"==typeof l&&(l=parseFloat(l)*n/100),r.now>r.max)l&&(n-=2*l),i=Math.floor(n*r.max);else if(r.base&&r.now<r.base){l&&(i-=2*l);const e=1/(r.wide||r.min);n=Math.floor(Math.min(i*e,n))}this.classList.toggle("has-margins",!!l),this.sth=n,this.stw=i,this.AR=i/n;const g=this.is_portrait?Math.min(n,i*(1/r.base)):n;t.style.setProperty("--stw",i+"px"),t.style.setProperty("--sth",n+"px");let m=Math.floor(g/a*10**s)/10**s;t.style.fontSize=m+"px";let f=Math.floor(n/a*10**s)/10**s;t.style.setProperty("--sth-based-fs",f+"px"),t.style.setProperty("--sth-based-fs-em",f/m+"em"),this.scaling=m/16;for(let e of be)e.rendered?e.onResized(r,ve):(e.skipped_onResized=!0,e.skipped_params=[r,ve]);const _=r.base-r.min;let v=null;this.is_portrait&&(v=(r.base-r.now)/_,v=Math.max(0,Math.min(1,v))),this.style.setProperty("--extra",null===v?0:v)}updateAspect(e){this.initial_ratios||(this.initial_ratios=e),ve?Object.assign(ve,e):ve=e,ve.portrait&&(ve.portrait_min||(ve.portrait_min=.01),ve.portrait_max||(ve.portrait_max=ve.portrait)),ve.threshold||(ve.threshold=1),ve.cross_margin||(ve.cross_margin=0),this.resize()}buildCSSForLangs(){let e="";for(let t of this.languages)e+=`vision-stage[lang='${t}'] [lang]:not([lang='${t}']) { display: none !important }\n`;const t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}setupSounds(){e("info","setupSounds");const t=le(this).sounds;if(t)return this.sounds={},window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audio_context=new window.AudioContext,this.gain_node=this.audio_context.createGain(),re||oe?Promise.all(t.map((([e,t,s={}])=>fetch(t).then((e=>e.arrayBuffer())).then((t=>(this.audio_context.decodeAudioData(t,(t=>{this.sounds[e]={audio_buffer:t,options:s}})),"success")))))):Promise.all(t.map((([t,s,i={}])=>fetch(s).then((e=>e.arrayBuffer())).then((e=>this.audio_context.decodeAudioData(e))).then((e=>this.sounds[t]={audio_buffer:e,options:i})).catch((t=>e("err",t))))))}playSound(t){if(!this.sounds[t])return void e("err","no sound with name:",t,"check if sounds are set up");const{audio_buffer:s,options:i}=this.sounds[t],n=this.audio_context.createBufferSource();n.buffer=s,this.gain_node.gain.value=this.global_volume*(i.volume||1),n.connect(this.gain_node).connect(this.audio_context.destination),this.playing_source=n,i.delay?setTimeout((e=>{n.start()}),i.delay):n.start()}stopSound(e){this.playing_source&&(this.playing_source.stop(),this.playing_source=null)}prop(t,s){let i=this,n=t.split("."),r=n.pop();for(let e of n)i=i[e];if(i){if(void 0===s)return Ee.init(this,i,r,n[0]||r),Ee;try{i[r]=s}catch(t){e("err","err:",t)}return this[n[0]]=this[n[0]],this}e("err","cannot get prop",t)}valueFromObject(e,t,s){return setTimeout((e=>this.render())),t(e)?s(e):null}registerSW(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then((t=>{e("info","Service Worker Registered"),t.onupdatefound=()=>{let s=t.installing;s.onstatechange=async()=>{switch(e("ok","SW State: ",s.state),s.state){case"installed":setTimeout((()=>{Ae?e("info","SW Update is available, waiting for activation…"):this.classList.add("cached")}),200);break;case"activated":if(Ae)break;case"redundant":Ae=!0}}},setInterval((()=>{e("ok","checking for service worker update..."),t.update()}),18e5)}))}}Se._properties={title:"",resizing:{value:!1,class:"resizing",reactive:!1},global_volume:{value:.6,storable:!0,reactive:!1},lang:{value:navigator.language.slice(0,2),storable:!0,force_render:!0,watcher(t,s){let[i,n]=navigator.language.split("-");if(document.documentElement.setAttribute("lang",t),this.country=n,this.setAttribute("lang",t),this.lang_index=this.languages.indexOf(t),this.onLanguageChanged&&this.onLanguageChanged(t,s),this.pages&&this.page){let{path:e,title:t}=this.getPage();location.hash=e,this.$doc_title&&(document.title=this.$doc_title+" • "+t)}e("info","lang, country:",i,n)}},night_mode:{value:0,storable:!0,attribute:["night-mode","auto"],init_watcher:!0,watcher(e){document.body.classList.toggle("night-mode-1",1===e),document.body.classList.toggle("night-mode-2",2===e)}},menu_open:{value:!1,class:"menu-open"},page:{value:null,attribute:"page",watcher(e,t){!e&&location.href.endsWith("#")&&window.self===window.top&&history.replaceState(null,"",location.pathname),this.onPageChanged&&this.onPageChanged(e,t)}}},Se._strings={fullscreen:["Fullscreen","Plein écran"],night_mode:["Night Mode","Mode nuit"]};const Ee={init(e,t,s,i){this.target=e,this.prop_object=t,this.prop_name=s,this.parent_prop_name=i,this.prop=this.prop_object[this.prop_name]},resetTarget(){return this.target[this.parent_prop_name]=this.target[this.parent_prop_name],this},push(e){return this.prop.push(e),this.resetTarget(),e},pushStart(e){return this.prop.unshift(e),this.resetTarget(),e},pop(){return setTimeout((e=>this.resetTarget())),this.prop.pop()},popStart(){return setTimeout((e=>this.resetTarget())),this.prop.shift()},splice(e,t=1,...s){this.prop.splice(e,t,...s),this.resetTarget()},remove(e){this.splice(e)},insert(e,...t){this.splice(e,0,...t)},flip(){this.prop_object[this.prop_name]=!this.prop_object[this.prop_name],this.resetTarget()},toggleSelect(e){this.prop_object[this.prop_name]=this.prop===e?null:e,this.resetTarget()},get(t,s=!0){e("check","get:",t,"this.prop:",this.prop);let i=this.prop.find((([e,s])=>e===t));return s?(i||[])[1]:i},set(e,t){let s=this.get(e,!1);s?s[1]=t:this.prop.push([e,t]),this.resetTarget()},nextIn(e,t=1,s=!0){let i=e.indexOf(this.prop),n=e.length+i+t;var r,o,a;return s?n%=e.length:(r=n,o=0,a=e.length-1,n=Math.max(Math.min(r,a),o)),this.prop_object[this.prop_name]=e[n]}};let ke="";async function Te(e,t,s,i=""){return i&&(ke=i),s&&s.length&&(s=s.map((e=>Ne.load(e))),await Promise.all(s)),window.customElements.define(e,t),window.customElements.whenDefined(e).then((()=>{"vision-stage"===e&&(ge.resize(),ge.classList.add("resized"),setTimeout((e=>{window.addEventListener("resize",de(ge.resize.bind(ge),300,300))})))}))}function Fe(e,t,s){let i=ge.icons_path||ke+"/_assets/images/icons.svg";return we[e]&&(e=we[e]),j`<svg class=${t?"icon "+t:"icon"} viewBox=${ye[e]||"0 0 32 32"} preserveAspectRatio=${q(s)}>
		<use href='${i}#${e}'/>
	</svg>`}function Le(e,t="",s={}){return j`<span class='vs-icon ${t}'>${Fe(e,s.svg_class||"",s.ar)}</span>`}function Re(e){return e||{}}function Pe(e){const t=[],s=e.map((e=>Array.isArray(e)?e[0]:e)).map(((e,s)=>"string"==typeof e?Ce(e,t,s):function(e,t,s){let[i,n]=Ve(e.map((e=>e.split(" | "))));return t[s]=n,i}(e,t,s))),i=e.map(((e,t)=>Array.isArray(e)?void 0!==e[1]?e[1]:Ce(e[0][0]):s[t]));return{labels:s,values:i,details:t,classes:e.map((e=>e[2]))}}function Ce(e,t,s){let[i,n]=e.split(" | ");return t&&(t[s]=n),i}const Ve=e=>e.reduce(((e,t)=>e.forEach(((e,s)=>e.push(t[s])))||e),Array.from(Array(e[0].length),(()=>[]))),Me=(...e)=>e.filter((e=>e)).join(" "),Oe=e=>"string"==typeof e?{label:e,class:e}:{...e,class:e.label},$e=e=>({labels:e.map((t=>"string"==typeof t?t:void 0!==t.label?t.label:e[0].label)),details:e.map((e=>e.detail)),values:e.map((e=>void 0!==e.value?e.value:Array.isArray(e.label)?e.label[0]:e.label||e)),classes:e.map((t=>void 0!==t.class?t.class:t.label?void 0:e[0].class)),selected_class:e.map((t=>void 0!==t.selected_class?t.selected_class:void 0===t.label?e[0].selected_class:void 0)),icons:e.map((e=>e.icon))});function je(e,t){let s=me[e];return s?s[t]:void 0}function ze(t,s,i,n=!1){if(ge&&ge.do_not_store)return;if(!me)return null;t&&(n?(e("err","DELETE:",t,s),me[t]&&(delete me[t][s],Object.keys(me[t]).length||delete me[t])):(e("pink","STORING:",t,s,i),void 0===me[t]&&(me[t]={}),me[t][s]=i));const r=JSON.stringify(me);pe.store&&e("pink","--will store string:",r),localStorage.setItem(fe,r)}function Ie(t){e("err","clear store"),ge.do_not_store=!0,localStorage.removeItem(fe),e("err","Store cleared"),location.reload()}const We=de(ze,200);var He,qe,Be,De;He=window.document,qe=function(){for(var e,t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=0,i=t.length,n={};s<i;s++)if((e=t[s])&&e[1]in He){for(s=0;s<e.length;s++)n[t[0][s]]=e[s];return n}return!1}(),Be={change:qe.fullscreenchange,error:qe.fullscreenerror},De={request:function(e,t){return new Promise(function(s,i){var n=function(){this.off("change",n),s()}.bind(this);this.on("change",n);var r=(e=e||He.documentElement)[qe.requestFullscreen](t);r instanceof Promise&&r.then(n).catch(i)}.bind(this))},exit:function(){return new Promise(function(e,t){if(this.isFullscreen){var s=function(){this.off("change",s),e()}.bind(this);this.on("change",s);var i=He[qe.exitFullscreen]();i instanceof Promise&&i.then(s).catch(t)}else e()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,t){var s=Be[e];s&&He.addEventListener(s,t,!1)},off:function(e,t){var s=Be[e];s&&He.removeEventListener(s,t,!1)},raw:qe},qe?(Object.defineProperties(De,{isFullscreen:{get:function(){return Boolean(He[qe.fullscreenElement])}},element:{enumerable:!0,get:function(){return He[qe.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(He[qe.fullscreenEnabled])}}}),window.screenfull=De):window.screenfull={isEnabled:!1};export{Ne as Component,Pe as Options,Ee as P,Se as VisionStage,ie as cache,Me as classes,Ie as clearStore,$e as createOptions,Te as define,te as guard,j as html,Le as icon,q as ifDefined,Oe as labelAsClassMapper,Y as live,Re as maybe,X as repeat,ze as saveStore,z as svg,W as unsafeHTML,Fe as useSVG};
